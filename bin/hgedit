#!/bin/sh
#
# `hg status` lists paths from the location of the .hg directory.  But I
# want to be down in the directory tree deeper than that, find out
# what's changed and edit it all.  So this script looks for a .hg dir
# and walks back up to its containing dir before calling `hg status`
#

# where is the .hg dir?
while [ ! -d "$PWD/.hg" ] ; do
    if [ "$PWD" = "/" ] ; then
        echo "abort: There is no Mercurial repository here (.hg not found)!"
        exit -1
    fi
    # walk up the dir tree until we find it...
    cd ..
done

if [ "$1" = "-og" ]; then
    echo "editing outgoing (commited) files..."
    hg outgoing -v -S | grep files | awk '{for (i=2; i<=NF; i++)  print $i }' | sort | uniq
    hg outgoing -v -S | grep files | awk '{for (i=2; i<=NF; i++)  print $i }' | sort | uniq | xargs open -a $EMACS_APP
else
    echo "editing edited (uncommited) files..."
    hg status -S | awk '{ print $2 }'
    hg status -S | awk '{ print $2 }' | xargs open -a $EMACS_APP
fi
